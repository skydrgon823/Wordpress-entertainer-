function parameter_value(a,b){var c=new RegExp(b+"=([^&]*)","i").exec(a);return c&&c[1]||""}var mutual_friends,bmf_ajax_request=null;!function(a){mutual_friends={init:function(){mutual_friends.init_maginific_popup(),a("body").on("click","a.mutual-friends",mutual_friends.fetch_mutual_friend),a("body").on("click",".friendship-button a",mutual_friends.add_remove_friendship),a("body").on("click","a.bmf-load-more",mutual_friends.member_loop_next_page),a(document).ajaxComplete(mutual_friends.rebind_magnific_popup)},fetch_mutual_friend:function(b){b.preventDefault();var c=a(this);a("div.bmf-white-popup").html('<div class="bmf-spinner"></div>');var d=c.data("user-id"),e={action:c.data("action"),user_id:d};a.post(ajaxurl,e,function(b){a("div.bmf-white-popup").find("div.bmf-spinner").remove(),a("div.bmf-white-popup").append(b)})},init_maginific_popup:function(){a("a.mutual-friends").magnificPopup({mainClass:"mfp-with-fade",removalDelay:100,callbacks:{beforeClose:function(){this.content.addClass("mfp-with-fade")},close:function(){this.content.removeClass("mfp-with-fade")}},midClick:!0,items:{src:a('<div id="buddypress" class="bmf-white-popup"></div>'),type:"inline"}})},rebind_magnific_popup:function(b,c,d){if(null!=bmf_ajax_request)return bmf_ajax_request=null,!1;var e=d.data,f=parameter_value(e,"action");if("members_filter"===f)var g=setTimeout(function(){var b=a("#buddypress").find("a.mutual-friends");return"undefined"!=typeof b?(mutual_friends.init_maginific_popup(),clearInterval(g),!1):void 0},1e3)},add_remove_friendship:function(){a(this).parent().addClass("loading");var b=a(this).attr("id"),c=a(this).attr("href"),d=a(this);return b=b.split("-"),b=b[1],c=c.split("?_wpnonce="),c=c[1].split("&"),c=c[0],a.post(ajaxurl,{action:"addremove_friend",cookie:bp_get_cookies(),fid:b,_wpnonce:c},function(b){var c=d.attr("rel"),e=d.parent();"add"===c?a(e).fadeOut(200,function(){e.removeClass("add_friend"),e.removeClass("loading"),e.addClass("pending_friend"),e.fadeIn(200).html(b)}):"remove"===c&&a(e).fadeOut(200,function(){e.removeClass("remove_friend"),e.removeClass("loading"),e.addClass("add"),e.fadeIn(200).html(b)})}),!1},member_loop_next_page:function(b){var c=a(this).parent(),d=c.parent();b.preventDefault();var e=parseInt(c.data("next-page-no"),10),f=e+1,g=parseInt(c.data("total-page-count"),10);g>=e&&(d.addClass("loading"),bmf_ajax_request=a.post(ajaxurl,{action:"members_filter",cookie:bp_get_cookies(),object:"members",search_terms:"",page:e,template:"",bmf_dialog:!0},function(b){d.removeClass("loading");var c=a(b).find("li");a("#members-list").append(c),f>g&&a("ul.activity-list").hide()})),c.data("next-page-no",f)}},a(document).ready(function(){mutual_friends.init()})}(jQuery);