"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};jQuery(function(){return MPSUM.init()});var $=jQuery,MPSUM={timer:null,delay:500,init:function(){var a=this;this.__register_update_toggle_events(),this.__register_save_settings_event(),this.__register_bulk_actions_event(),this.__register_pagination_events(),this.__register_filter_link_events(),this.__register_logs_filter_event(),this.__register_excluded_user_event(),this.__register_force_updates_event(),this.__register_enable_logs_event(),this.__register_clear_logs_event(),this.__register_reset_options_event(),this.__register_advanced_tab_menu_events(),this.__register_log_search_event(),this.__register_multisite_get_plugins_list(),this.__register_multisite_get_themes_list(),this.__register_disable_admin_bar_options_event(),this.__register_enable_admin_bar_options_event(),this.__register_logs_expand_event(),window.onpopstate=function(b){a.__register_advanced_on_pop_state(b)},this.__register_advanced_on_pop_state({}),this.__register_on_resize()},__register_on_resize:function(){MPSUM.__advanced_section_move(),$(window).resize(function(){MPSUM.__advanced_section_move()})},__advanced_section_move:function(){768>=$(window).width()?$(".eum-advanced-settings-container:visible").insertAfter("div.active-menu").addClass("active"):$(".eum-advanced-settings-container:visible").appendTo("#eum-adv-settings").addClass("active")},__register_advanced_on_pop_state:function(){var a=wpAjax.unserialize(window.location.href);if("action"in a&&$(".eum-updated").delay(5e3).slideUp(2e3),"option"in a)$("*[data-menu_name=\""+a.option+"\"]").click();else{var b=$($("*[data-menu_name]")[0]);b.trigger("click")}},render:function(a){this.__render_filter_links(a.views),this.__render_rows(a.rows),this.__render_headers(a.headers),this.__render_pagination_top(a.pagination.top),this.__render_pagination_bottom(a.pagination.bottom),this.__unblockUI(),this.init()},send_command:function(a,b,c,d){var e=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];e&&this.__blockUI({css:{width:"300px",border:"none","border-radius":"10px",left:"calc(50% - 150px)",padding:"20px"},message:"<div style=\"margin: 8px; font-size:150%;\" class=\"eum_saving_popup\"><img src=\""+mpsum.logo+"\" height=\"80\" width=\"80\"><br>"+mpsum.working+"</div>"});var f={json_parse:!0,alert_on_error:!0,action:"eum_ajax",nonce:mpsum.eum_nonce,nonce_key:"eum_nonce",timeout:null,async:!0,type:"POST"};for(var g in"undefined"==typeof d&&(d={}),f)d.hasOwnProperty(g)||(d[g]=f[g]);var h={action:d.action,subaction:a,nonce:d.nonce,nonce_key:d.nonce_key};if(h[d.nonce_key]=d.nonce,"object"===("undefined"==typeof b?"undefined":_typeof(b)))for(var i in b)h[i]=b[i];else h.action_data=b;var j={type:d.type,url:ajaxurl,data:h,success:function(a,b){if(d.json_parse){var e;try{e=MPSUM.parse_json(a)}catch(b){return console.log(b),console.log(a),void(d.alert_on_error&&alert(mpsum.unexpected_response+" "+a))}"function"==typeof c&&c(e,b,a)}else"function"==typeof c&&c(a,b)},error:function(a,b,c){"function"==typeof d.error_callback?d.error_callback(a,b,c):(console.log("eum_send_command: error: "+b+"  ("+c+")"),console.log(a))},dataType:"text",async:d.async};null!=d.timeout&&(j.timeout=d.timeout),jQuery.ajax(j)},parse_json:function(a){try{var b=JSON.parse(a);return b}catch(b){console.log("EUM: Exception when trying to parse JSON (1) - will attempt to fix/re-parse"),console.log(a)}var c=a.indexOf("{"),d=a.lastIndexOf("}");if(-1<c&&-1<d){var e=a.slice(c,d+1);try{var f=JSON.parse(e);return console.log("EUM: JSON re-parse successful"),f}catch(b){console.log("EUM: Exception when trying to parse JSON (2) - will attempt to fix/re-parse based upon bracket counting");for(var g,h=c,i=0,j="",k=!1;(0<i||h==c)&&h<=d;)g=a.charAt(h),k||"{"!=g?k||"}"!=g?"\""==g&&"\\"!=j&&(k=!k):i--:i++,j=g,h++;console.log("Started at cursor="+c+", ended at cursor="+h+" with result following:"),console.log(a.substring(c,h));try{var l=JSON.parse(a.substring(c,h));return console.log("EUM: JSON re-parse successful"),l}catch(a){throw a}}}throw"EUM: could not parse the JSON"},gather_settings:function(a){var b="";return a="undefined"==typeof a?"string":a,b="object"===a?$("input, select").serializeJSON({checkboxUncheckedValue:"0",useIntKeysAsArrayIndex:!0}):$("input, select").serialize(),b},__get_data:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c={},d=$("#current-page-selector"),e=null;null!==b&&(e=b.search.substring(1)),"pagination"===a?c.paged=this.__query(e,"paged"):"pagination_input"===a||"bulk"===a||"save_settings"===a?c.paged=parseInt($("input[name=paged]").val())||"1":void 0,c.m=$("#filter-by-date").val(),c.status=$("#filter-by-success").val(),c.action_type=$("#filter-by-action").val(),c.type=$("#filter-by-type").val(),c.order=$("#filter-by-order").val(),c.data=this.gather_settings("string"),c.is_search=!1;var f=wpAjax.unserialize(window.location.href);return c.is_search?(c.tab=d.data("tab")||f.tab,c.view="search"):null===e?(c.tab=d.data("tab")||f.tab,c.view=d.data("view")||"all"):(c.tab=f.tab,c.view=this.__query(e,"view")||"all"),c},__query:function(a,b){for(var c,d=a.split("&"),e=0;e<d.length;e++)if(c=d[e].split("="),b===c[0])return c[1];return!1},__blockUI:function(){$.blockUI({css:{width:"300px",border:"none","border-radius":"10px",left:"calc(50% - 150px)",padding:"20px"},message:"<div style=\"margin: 8px; font-size:150%;\" class=\"eum_saving_popup\"><img src=\""+mpsum.logo+"\" height=\"80\" width=\"80\"><br>"+mpsum.working+"</div>"})},__unblockUI:function(){$(".wrap .fade").delay(6e3).fadeOut(2e3),$.unblockUI()},__register_update_toggle_events:function(){var a=this;$(".eum-toggle-button").unbind("click"),$(".eum-toggle-button").on("click",function(b){var c=wpAjax.unserialize(window.location.href),d=c.tab;if(b.preventDefault(),null!=d&&"general"!=d){var e=$(b.currentTarget),f=e.closest(".toggle-wrapper").find("input"),g=e.closest(".toggle-wrapper"),h=g.closest(".eum-"+d+"-name-actions").find(".eum-"+d+"-automatic-wrapper"),i=e.closest("tr");e.addClass("eum-active"),e.hasClass("eum-enabled")?(e.next().removeClass("eum-active"),f.prop("value","true"),g.hasClass("toggle-wrapper-"+d)&&(i.removeClass("inactive").addClass("active"),h.find("input").prop("value",!1),h.find(".eum-disabled").addClass("eum-active"),h.find(".eum-enabled").removeClass("eum-active"),h.slideDown())):(g.hasClass("toggle-wrapper-"+d)&&(i.removeClass("active").addClass("inactive"),h.slideUp()),e.prev().removeClass("eum-active"),f.prop("value","false"),h.find("input").prop("value",!1));var j=a.__get_data("save_settings");a.send_command("save_"+d+"_update_options_and_render",j,function(a){$(".subsubsub").replaceWith(a.views),setTimeout(function(){MPSUM.__unblockUI(),MPSUM.init()},2e3)})}})},__register_save_settings_event:function(){var a=this;$("#eum-save-settings").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data("save_settings");a.send_command("save_"+c.tab+"_update_options_and_render",c,function(b){$(".subsubsub").replaceWith(b.views),a.__unblockUI(),a.init()})})},__register_bulk_actions_event:function(){var a=this;$(".wrap").on("click","#doaction, #doaction2",function(b){if(b.preventDefault(),b.stopImmediatePropagation(),0!==$("input:checked").length){var c=a.__get_data("bulk");a.send_command("bulk_action_"+c.tab+"_update_options_and_render",c,function(b){a.render(b),$("#bulk-action-selector-top, #bulk-action-selector-bottom").val("-1")})}})},__register_pagination_events:function(){var a=this;$(".tablenav-pages a").on("click",function(b){b.preventDefault();var c=a.__get_data("pagination",b.currentTarget);a.__get_tab_content_and_render(c)}),$("input[name=paged]").on("keyup",function(b){13===b.which&&b.preventDefault(),window.clearTimeout(a.timer),a.timer=window.setTimeout(function(){var b=a.__get_data("pagination_input");a.__get_tab_content_and_render(b)},a.delay)})},__register_filter_link_events:function(){var a=this;$(".subsubsub a").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation(),$(".subsubsub a").removeClass("current"),$(b.currentTarget).addClass("current");var c=a.__get_data("filters",b.currentTarget);a.__get_tab_content_and_render(c)})},__register_logs_filter_event:function(){var a=this;$("#post-query-submit").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data();a.__get_tab_content_and_render(c)}),$("#filter-by-date, #filter-by-success, #filter-by-action, #filter-by-type, #filter-by-order").on("change",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data();a.__get_tab_content_and_render(c)})},__register_excluded_user_event:function(){var a=this;$("#save-excluded-users").on("click",function(b){b.preventDefault(),a.send_command("save_excluded_users",{data:a.gather_settings("string")},function(b){$("#result").css("display","block").html("<div class=\"updated\"><p>"+b+"</p></div>").delay(2e3).slideUp(2e3),a.__unblockUI()})})},__register_force_updates_event:function(){var a=this;$("#force-updates").on("click",function(b){b.preventDefault(),"function"==typeof updraft_backupnow_inpage_go&&1===$("#backup_force_updates:checked").length?updraft_backupnow_inpage_go(function(){$("#updraft-backupnow-inpage-modal").dialog("close"),a.__send_force_updates_request()},"themes,plugins,wpcore","autobackup",null):a.__send_force_updates_request()})},__send_force_updates_request:function(){var a=this,b=$("#footer-upgrade strong a").html();this.send_command("force_updates",{},function(c){$("#result").css("display","block").html("<div class=\"updated\"><p>"+c.message+"</p></div>").delay(5e3).slideUp(2e3),a.__unblockUI(),!0===c.ran_immediately?(0<c.update_data.counts.total?a.__update_notifications(c.update_data):a.__remove_update_notifications(c.update_data),"undefined"!=typeof b&&$("#footer-upgrade strong").html(b.substr(4)),$("#result").css("display","block").html("<div class=\"updated\"><p>"+c.message+"</p></div>").delay(5e3).slideUp(2e3)):($("#result").css("display","block").html("<div class=\"updated\"><p>"+c.message+"</p></div>").delay(5e3).slideUp(2e3),setTimeout(function(){return location.reload()},6e4))})},__remove_update_notifications:function(){$("#wp-admin-bar-updates").remove(),$(".update-nag").remove(),$(".update-plugins").remove()},__update_notifications:function(a){$(".update-nag").remove(),$("#wp-admin-bar-updates").html(a.admin_bar_link),$("#menu-dashboard ul li:nth-child(3) a").html(a.updates_link),$("#menu-appearance a div:nth-child(3)").html(a.themes_link),$("#menu-plugins a div:nth-child(3)").html(a.plugins_link)},__register_enable_logs_event:function(){var a=this;$("#enable-logs").on("click",function(b){b.preventDefault(),a.send_command("enable_logs",{},function(b){$("#result").css("display","block").html("<div class=\"updated\"><p>"+b+"</p></div>").delay(5e3).slideUp(2e3),a.__unblockUI()})})},__register_clear_logs_event:function(){var a=this;$("#clear-logs").on("click",function(b){b.preventDefault(),a.send_command("clear_logs",{},function(b){$("#result").css("display","block").html("<div class=\"updated\"><p>"+b+"</p></div>").delay(5e3).slideUp(2e3);var c=$(".wp-list-table thead th").length;$("#the-list").html("<tr class=\"no-items\"><td class=\"colspanchange\" colspan=\""+c+"\">"+mpsum.logs_no_items+"</td></tr>"),$(".tablenav-pages").remove(),a.__unblockUI()})})},__register_reset_options_event:function(){var a=this;$("#reset-options").on("click",function(b){b.preventDefault(),a.send_command("reset_options",{},function(){var a=window.location.href;a+="&action=reset&option=reset-options",window.location.href=a})})},__register_disable_admin_bar_options_event:function(){var a=this;$("#adminbar").on("click","#disable-admin-bar",function(b){b.preventDefault(),a.send_command("disable_admin_bar",{},function(b){$("#result").css("display","block").html("<div class=\"updated\"><p>"+b.message+"</p></div>").delay(5e3).slideUp(2e3),$("#disable-admin-bar").val(mpsum.enable_admin_bar),$("#disable-admin-bar").attr("id","enable-admin-bar"),a.__unblockUI(),window.location.href=window.location.href})})},__register_enable_admin_bar_options_event:function(){var a=this;$("#adminbar").on("click","#enable-admin-bar",function(b){b.preventDefault(),a.send_command("enable_admin_bar",{},function(b){$("#result").css("display","block").html("<div class=\"updated\"><p>"+b.message+"</p></div>").delay(5e3).slideUp(2e3),$("#enable-admin-bar").val(mpsum.disable_admin_bar),$("#enable-admin-bar").attr("id","disable-admin-bar"),a.__unblockUI(),window.location.href=window.location.href})})},__render_filter_links:function(a){"undefined"!==a&&a.length&&$(".subsubsub").replaceWith(a)},__render_rows:function(a){"undefined"!==a&&a.length&&$("#the-list").html(a)},__render_headers:function(a){"undefined"!==a&&a.length&&$("thead tr, tfoot tr").html(a)},__render_pagination_top:function(a){"undefined"!==a&&0<a.length?$(".tablenav.top .tablenav-pages").html($(a).html()):$(".tablenav.top .tablenav-pages").html("")},__render_pagination_bottom:function(a){"undefined"!==a&&0<a.length?$(".tablenav.bottom .tablenav-pages").html($(a).html()):$(".tablenav.bottom .tablenav-pages").html("")},__get_tab_content_and_render:function(a){var b=this;this.send_command("update_"+a.tab+"_tab",a,function(a){b.render(a)})},__register_advanced_tab_menu_events:function(){$("#eum-adv-settings-menu div > div").on("click",function(a){var b=a.currentTarget.dataset.menu_name;$(".eum-advanced-settings-container:not("+b+")").hide(),$("#eum-adv-settings-menu div > div").removeClass("active-menu"),$(".eum-advanced-settings-container").removeClass("active"),$(a.currentTarget).addClass("active-menu"),$(".eum-advanced-settings-container."+b).css("display","block").addClass("active"),MPSUM.__advanced_section_move();var c=wpAjax.unserialize(window.location.href),d=""+location.protocol+"//"+(""+location.host+location.pathname),e=$($("*[data-menu_name]")[0]),f=b;d+="?page="+c.page+"&tab="+c.tab,f!=e.data("menu_name")&&(d+="&option="+f),"action"in c&&"reset-options"==f&&(d+="&action="+c.action),window.location.href!=d&&history.pushState("",document.title,d)})},__register_multisite_get_plugins_list:function(){var a=this;$(".eum-list-plugins-action").on("click",function(b){b.preventDefault();var c=$(b.target),d=c.data("plugin-file");c.siblings(".eum-list-plugins").html("<img src=\""+mpsum.spinner+"\" alt=\"Loading...\" />"),a.send_command("get_multisite_installs_from_plugin",{data:{plugin_file:d}},function(a){c.siblings(".eum-list-plugins").html(a.message)},{},!1)})},__register_multisite_get_themes_list:function(){var a=this;$(".eum-list-themes-action").on("click",function(b){b.preventDefault();var c=$(b.target),d=c.data("theme-file");c.siblings(".eum-list-themes").html("<img src=\""+mpsum.spinner+"\" alt=\"Loading...\" />"),a.send_command("get_multisite_installs_from_theme",{data:{stylesheet:d}},function(a){c.siblings(".eum-list-themes").html("<div class=\"mpsum-message\">"+a.message+"</div>")},{},!1)})},__register_log_search_event:function(){var a=this;$("#log-query-search").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data(),d=$("#eum-log-search").val().trim();return""==d?void a.__get_tab_content_and_render(c):void(c.is_search=!0,c.search_term=d,c.view="search",a.__get_tab_content_and_render(c))})},__register_logs_expand_event:function(){$(".eum-note-expand").on("click",function(a){a.preventDefault(),$(a.target).siblings("div").toggle()})}};